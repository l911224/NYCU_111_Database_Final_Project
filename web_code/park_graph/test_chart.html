<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
    </head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <body>
        <input type="button" value="回首頁" class="submit" onclick="window.location.href='../index.html'"/>
        <br/>
        <br/>
        <select id = "park-list" name = "choice" class = "choice">
            <option value="none" selected disabled hidden>請選擇停車場</option> 
            <option value="府後地下停車場">府後地下停車場</option>
            <option value="赤土崎地下停車場">赤土崎地下停車場</option>
            <option value="牛埔地下停車場">牛埔地下停車場</option>
            <option value="北區行政大樓地下停車場">北區行政大樓地下停車場</option>
            <option value="遠東巨城購物中心停車場">遠東巨城購物中心停車場</option>
            <option value="研發二路立體停車場">研發二路立體停車場</option>
            <option value="興業二路地下停車場">興業二路地下停車場</option>
            <option value="大魯閣湳雅廣場停車場">大魯閣湳雅廣場停車場</option>
            <option value="篤行污水處理廠營業所停車場">篤行污水處理廠營業所停車場</option>
            <option value="矽導竹科研發中心營業所停車場">矽導竹科研發中心營業所停車場</option>
            <option value="勞山機車停車場">勞山機車停車場</option>
            <option value="後站機車停車場-2">後站機車停車場-2</option>
            <option value="南大機車停車場">南大機車停車場</option>
            <option value="台大醫院新竹分院停車場">台大醫院新竹分院停車場</option>
            <option value="新竹民權路停車場">新竹民權路停車場</option>
            <option value="新竹停一機車停車場">新竹停一機車停車場</option>
            <option value="新竹停二機車停車場">新竹停二機車停車場</option>
            <option value="新竹港區第一停車場">新竹港區第一停車場</option>
            <option value="新竹港區第二停車場">新竹港區第二停車場</option>
            <option value="中正市場停車場">中正市場停車場</option>
            <option value="北大路(大客車)停車場">北大路(大客車)停車場</option>
            <option value="生命園區停車場">生命園區停車場</option>
            <option value="竹光國民運動中心地下停車場">竹光國民運動中心地下停車場</option>
            <option value="東大陸橋下(中央站)停車場">東大陸橋下(中央站)停車場</option>
            <option value="東大陸橋下(中華站)停車場">東大陸橋下(中華站)停車場</option>
            <option value="後火車站機車停車場-1">後火車站機車停車場-1</option>
            <option value="頂竹圍地下停車場">頂竹圍地下停車場</option>
            <option value="稅務大樓地下停車場">稅務大樓地下停車場</option>
            <option value="新科國中地下停車場">新科國中地下停車場</option>
            <option value="新科國中地下停車場-機車">新科國中地下停車場-機車</option>
            <option value="台溪停車場">台溪停車場</option>
            <option value="火車站後站汽車停車場-1">火車站後站汽車停車場-1</option>
            <option value="火車站後站汽車停車場-2">火車站後站汽車停車場-2</option>
            <option value="火車站後站汽車停車場-3">火車站後站汽車停車場-3</option>
            <option value="火車站後站汽車停車場-4">火車站後站汽車停車場-4</option>
            <option value="北大路停車場">北大路停車場</option>
            <option value="延平停車場">延平停車場</option>
            <option value="東園市場停車場">東園市場停車場</option>
            <option value="果菜市場停車場">果菜市場停車場</option>
            <option value="武陵路73巷停車場">武陵路73巷停車場</option>
            <option value="香山區行政大樓地下停車場">香山區行政大樓地下停車場</option>
            <option value="湳雅街停車場">湳雅街停車場</option>
            <option value="園區陸橋下停車場">園區陸橋下停車場</option>
            <option value="慈雲路停車場">慈雲路停車場</option>
            <option value="新莊129巷停車場">新莊129巷停車場</option>
            <option value="新竹動物園停車場">新竹動物園停車場</option>
            <option value="新竹明志書院停車場">新竹明志書院停車場</option>
            <option value="明湖停車場">明湖停車場</option>
            <option value="青草湖停車場">青草湖停車場</option>
            <option value="新竹錦華1停車場">新竹錦華1停車場</option>
            <option value="新竹錦華2停車場">新竹錦華2停車場</option>
            <option value="新竹市立棒球場停車場">新竹市立棒球場停車場</option>
            <option value="民富停車場">民富停車場</option>
            <option value="新竹林森站立體停車場">新竹林森站立體停車場</option>
        </select>
        <input type="submit" value="查詢" class="select_submit">
        <h3>汽車剩餘停車位統計表(7日內各時段平均):</h3>
        <canvas id="myChart1" style="width:100%;max-width:600px"></canvas>
        <h3>機車剩餘停車位統計表(7日內各時段平均):</h3>
        <canvas id="myChart2" style="width:100%;max-width:600px"></canvas>

        <script>
            window.onload = callapi_park_info;

            const select_submit = document.querySelector('.select_submit');
            const select_input=document.querySelector('.choice');
            
            var xValues = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];
            var yValues = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
            var test = 10
    
            async function callapi_park_info(parkinglot){
                var myHeaders = new Headers();
                myHeaders.append("Content-Type","application/json");
                var raw = JSON.stringify({"parkinglot":parkinglot});
                const response = await fetch("https://2tx3pcuwff.execute-api.us-east-1.amazonaws.com/dev" ,{method:"POST" , headers: myHeaders, body: raw, redirect: 'follow'});
                console.log(response);
                const data = await response.json();
                console.log(data);
                console.log(data.query[0]);
                changevalue(data.query);
            }

            
            function addData(chart, label, data) {
                chart.data.labels.push(label);
                chart.data.datasets.forEach((dataset) => {
                    dataset.data.push(data);
                });
                chart.update();
            }

            function removeData(chart) {
                chart.data.labels.pop();
                chart.data.datasets.forEach((dataset) => {
                    dataset.data.pop();
                });
                chart.update();
            }
            
            const mychart1 = new Chart("myChart1", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                fill: false,
                lineTension: 0,
                backgroundColor: "rgba(0,0,255,1.0)",
                borderColor: "rgba(0,0,255,0.1)",
                data: yValues
                }]
            },
            options: {
                legend: {display: false},
                scales: {   
                    yAxes: [{
                        scaleLabel: {
                            display: true, labelString: '剩餘車位', 
                        },
                        ticks: {
                            min: 0, max:test
                        }
                    }],
                    xAxes: [
                        {scaleLabel:{display: true, labelString: '時間(0 - 24)'}
                    }]
                }
            }
            });
            
            const mychart2 = new Chart("myChart2", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                fill: false,
                lineTension: 0,
                backgroundColor: "rgba(0,0,255,1.0)",
                borderColor: "rgba(0,0,255,0.1)",
                data: yValues
                }]
            },
            options: {
                legend: {display: false},
                scales: {   
                    yAxes: [{
                        scaleLabel: {
                            display: true, labelString: '剩餘車位', 
                        },
                        ticks: {
                            min: 0, max:test
                        }
                    }],
                    xAxes: [
                        {scaleLabel:{display: true, labelString: '時間(0 - 24)'}
                    }]
                }
            }
            });

            function select_park(){
                var address;
                address=select_input.value;
                console.log(address);
                callapi_park_info(address);
            }
            
            function changevalue(data) {
                for(let i = 0; i < 24; i++){
                    mychart1.data.datasets[0].data[i] = data[i][0];
                    console.log(mychart1.options.scales.yAxes[0].ticks)
                }
                if(data[0][2] == 0){
                    mychart1.options.scales.yAxes[0].ticks.max = 100;
                }
                else{
                    mychart1.options.scales.yAxes[0].ticks.max = data[0][2];
                }
                mychart1.update();
                
                for(let i = 0; i < 24; i++){
                    mychart2.data.datasets[0].data[i] = data[i][1];
                    console.log(mychart2.options.scales.yAxes[0].ticks)
                }
                if(data[0][3] == 0){
                    mychart2.options.scales.yAxes[0].ticks.max = 100;
                }
                else{
                    mychart2.options.scales.yAxes[0].ticks.max = data[0][3];
                }
                mychart2.update();
            }
            
            select_submit.addEventListener('click', select_park);
        </script>
    </body>
</html>


